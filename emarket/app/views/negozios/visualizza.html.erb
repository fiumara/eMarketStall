<!DOCTYPE html>
<html>
<head>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= stylesheet_link_tag 'application', media: 'all' %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
</head>
<body>
  <main class="negozio-page container">
    
    <% if @negozio.present? %>
      <section class="negozio-info card">
        <h1 class="negozio-nome"><%= @negozio.nome_negozio %></h1>
        <p class="negozio-descrizione"><%= @negozio.descrizione %></p>

        <% if @negozio.immagine.attached? %>
          <div class="negozio-img-wrapper">
            <%= image_tag @negozio.immagine.variant(resize_to_limit: [300, 300]), class: "negozio-img" %>
          </div>
        <% end %>

        <p><strong>Indirizzo:</strong> <%= @negozio.indirizzo %></p>
        <p><strong>Telefono:</strong> <%= @negozio.telefono %></p>
        <p><strong>Followers:</strong> <%= @negozio.followers.count %></p>

        <% if current_user.is_a?(Acquirente) %>
          <div class="negozio-actions">
            <%= button_to "Segnala", segnala_form_negozio_path(@negozio), method: :get, class: "btn btn-danger" %>

            <% if current_user.follows.exists?(negozio: @negozio) %>
              <%= button_to "Non seguire", negozio_unfollow_path(@negozio), method: :delete, class: "btn btn-warning" %>
            <% else %>
              <%= button_to "Segui", negozio_follow_path(@negozio), method: :post, class: "btn btn-primary" %>
            <% end %>

            <%= button_to "Scrivici", start_chat_rooms_path(destinatario_id: @negozio.id, destinatario_type: "Negozio"), method: :post, class: "btn btn-secondary" %>
          </div>
        <% end %>
      </section>
    <% else %>
      <p>Il negozio non Ã¨ stato trovato.</p>
    <% end %>

    <section class="proprietario card">
      <% if @negozio&.acquirente.present? %>
        <p><strong>Proprietario:</strong> <%= @negozio.acquirente.nome_utente %></p>
      <% else %>
        <p>Informazioni sul proprietario non disponibili.</p>
      <% end %>
    </section>

    <section class="prodotti card">
      <h2>Prodotti</h2>
      <% if @negozio&.prodottos.present? %>
        <div class="prodotti-grid">
          <% @negozio.prodottos.each do |prodotto| %>
            <div class="card prodotto-card">
              <p class="prodotto-nome"><%= prodotto.nome_prodotto %></p>
              <p class="prodotto-descrizione"><%= prodotto.descrizione %></p>
            </div>
          <% end %>
        </div>
      <% else %>
        <p>Non ci sono prodotti disponibili.</p>
      <% end %>
    </section>
  </main>
</body>
</html>
