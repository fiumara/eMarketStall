<h1 class="mb-4">I tuoi ordini</h1>

<% if @ordini.any? %>
  <table class="table table-hover table-bordered">
    <thead class="thead-dark">
      <tr>
        <th>Codice Ordine</th>
        <th>Data</th>
        <th>Totale</th>
        <th>Stato</th>
        <th>Indirizzo</th>
        <th>Azioni</th>
      </tr>
    </thead>
    <tbody>
      <% @ordini.each do |ordine| %>
        <tr>
          <td><%= ordine.codice_ordine %></td>
          <td><%= ordine.created_at.strftime("%d/%m/%Y %H:%M") %></td>
          
          <td>
            <% prezzo_originale = ordine.ordine_items.sum { |item| item.prodotto&.prezzo.to_f * item.quantity } %>
            <% prezzo_scontato = ordine.totale %>
            <% sconto_fedelta = ordine.sconto.to_f %>
            <% totale_finale = prezzo_scontato - sconto_fedelta %>

            <% if totale_finale < prezzo_originale %>
              <div>
                <span class="text-muted" style="text-decoration: line-through;">
                  <%= number_to_currency(prezzo_originale) %>
                </span>
                <span class="text-success fw-bold">
                  <%= number_to_currency(totale_finale) %>
                </span>
                <% if sconto_fedelta > 0 %>
                  <br><small class="text-info">Sconto fedelt√†: -<%= number_to_currency(sconto_fedelta) %></small>
                <% end %>
              </div>
            <% else %>
              <%= number_to_currency(totale_finale) %>
            <% end %>
          </td>

          <td><%= ordine.stato.humanize %></td>
          <td><%= ordine.indirizzo %></td>
          <td><%= link_to "Dettagli", ordine_path(ordine), class: "btn btn-sm btn-primary" %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>Non hai ancora effettuato ordini.</p>
<% end %>
