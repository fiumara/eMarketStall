<h2>Dettaglio Ordine: <%= @ordine.codice_ordine %></h2>

<p><strong>Data:</strong> <%= @ordine.created_at.strftime("%d/%m/%Y %H:%M") %></p>
<p><strong>Totale:</strong> €<%= @ordine.totale %></p>
<p><strong>Stato:</strong> <%= @ordine.stato.capitalize %></p>
<p><strong>Indirizzo di spedizione:</strong> <%= @ordine.indirizzo %></p>

<h3>Prodotti in questo ordine:</h3>
<table class="table">
  <thead>
    <tr>
      <th>Nome</th>
      <th>Quantità</th>
      <th>Prezzo originale</th>
      <th>Prezzo scontato</th>
      <th>Totale</th>
    </tr>
  </thead>
  <tbody>
    <% @ordine.ordine_items.each do |item| %>
      <% if item.prodotto.negozio_id == @negozio.id %>
        <tr>
          <td><%= item.prodotto.nome_prodotto %></td>
          <td><%= item.quantity %></td>
          <td>€<%= number_to_currency(item.prodotto.prezzo) %></td>
          <td>
            <% if item.prodotto.prezzo_scontato < item.prodotto.prezzo %>
              <strong>€<%= number_to_currency(item.prodotto.prezzo_scontato) %></strong>
              <small class="text-muted">(Scontato!)</small>
            <% else %>
              €<%= number_to_currency(item.prodotto.prezzo) %>
            <% end %>
          </td>
          <td>€<%= number_to_currency(item.prodotto.prezzo_scontato * item.quantity) %></td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>

<h3>Aggiorna Stato Ordine</h3>
<%= form_with url: negozio_ordine_path(@negozio, @ordine), method: :patch do |f| %>
  <%= f.label :stato, "Stato Ordine" %>
  <%= f.select :stato, Ordine.statos.keys.map { |s| [s.humanize, s] }, {}, class: "form-control" %>
  <%= f.submit "Aggiorna Stato", class: "btn btn-success mt-2" %>
<% end %>

